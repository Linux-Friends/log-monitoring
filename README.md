
<img src="https://capsule-render.vercel.app/api?type=waving&color=FFE146&height=300&section=header&text=DB-Saver&fontSize=70&fontColor=FFFFFF&animation=fadeIn&width=1200" width="1200" />


<br>
<br>

## ğŸ“ Contents
- [1ï¸âƒ£ Contributors](#1%EF%B8%8Fâƒ£-contributors)
- [2ï¸âƒ£ Overview](#2%EF%B8%8Fâƒ£-overview)
- [3ï¸âƒ£ Skills](#3%EF%B8%8Fâƒ£-skills)
- [4ï¸âƒ£ Expectations](#4%EF%B8%8Fâƒ£-expectations)
- [5ï¸âƒ£ How to do](#5%EF%B8%8Fâƒ£-how-to-do)
- [6ï¸âƒ£ Trouble Shooting](#6%EF%B8%8F%E2%83%A3-trouble-shooting)
- [7ï¸âƒ£ Retrospective](#7%EF%B8%8F%E2%83%A3-retrospective)

<br>
<br>

## 1ï¸âƒ£ Contributors
<br>

|<img src="https://github.com/DoomchitYJ.png" width="220" />|<img src="https://github.com/imhaeunim.png" width="220" />|<img src="https://github.com/jinhyunpark929.png" width="220" />|<img src="https://github.com/letmeloveyou82.png" width="220" />|
|:-:|:-:|:-:|:-:|
|ë°•ì˜ì§„<br/>[@DoomchitYJ](https://github.com/DoomchitYJ)|ì„í•˜ì€<br/>[@imhaeunim](https://github.com/imhaeunim)|ë°•ì§„í˜„<br/>[@jinhyunpark929](https://github.com/jinhyunpark929)|ìµœìœ¤ì •<br/>[@letmeloveyou82](https://github.com/letmeloveyou82)|

<br>

## 2ï¸âƒ£ Overview

### âš½ ëª©í‘œ <br>

- MySQL DB ì„œë²„ì˜ ë©”ëª¨ë¦¬ë¥¼ ëª¨ë‹ˆí„°ë§í•˜ê³  ë¡œê·¸ ì €ì¥
- ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ì— ë”°ë¼ ì¡°ì¹˜ ìë™ ì‹¤í–‰
- DB ì„œë²„ì˜ ì•ˆì •ì„± í™•ë³´
- ìœ ìš©í•œ ë¶€í•˜ í…ŒìŠ¤íŠ¸ íˆ´ì¸ jMeter ë‹¤ë£¨ê¸°

<br>

## 3ï¸âƒ£ Skills

### ğŸ›  Skills

**Tech Stack**

<div>
<img src="https://img.shields.io/badge/linux-FCC624?style=for-the-badge&logo=linux&logoColor=black">
<img src="https://img.shields.io/badge/mysql-4479A1?style=for-the-badge&logo=mysql&logoColor=white">
<img src="https://img.shields.io/badge/jmeter-D22128?style=for-the-badge&logo=apachejmeter&logoColor=white">

</div>

<br>

**Co-work Stack**

<div>
<img src="https://img.shields.io/badge/notion-000000?style=for-the-badge&logo=notion&logoColor=white">
<img src="https://img.shields.io/badge/github-303a50?style=for-the-badge&logo=github&logoColor=white">
<img src="https://img.shields.io/badge/slack-e01e5a?style=for-the-badge&logo=slack&logoColor=white">
</div>

<br>

## 4ï¸âƒ£ Action Plan
### ğŸš¨ ì¡°ì¹˜ <br>

- **ë©”ëª¨ë¦¬ 70% ì´ˆê³¼ ì‹œ ê²½ê³  ë©”ì¼ë§Œ ë°œì†¡í•˜ì—¬ ì‚¬ì „ ëŒ€ì‘**
- **ë©”ëª¨ë¦¬ 90% ì´ˆê³¼ ì‹œ DB ì„œë¹„ìŠ¤ëŠ” ìœ ì§€í•˜ë©´ì„œë„ ë¶€í•˜ë¥¼ ì¤„ì¼ ìˆ˜ ìˆëŠ” ì¡°ì¹˜ ì‹¤í–‰**
    - ì˜¤ë˜ëœÂ **ì¿¼ë¦¬ ì¢…ë£Œ**Â (ì‹¤í–‰ ì‹œê°„ì´ ê¸´ ì¿¼ë¦¬ ì •ë¦¬)
    - **Idle ì„¸ì…˜ ì¢…ë£Œ**Â (ë¶ˆí•„ìš”í•œ ì—°ê²° í•´ì œ)
    - **ìºì‹œ ì •ë¦¬**Â (OS ë ˆë²¨ ìºì‹œ í•´ì œ)
    - **ìŠ¤ì™‘ í•´ì œ & ì¬í™œì„±í™”**Â (Swap ì‚¬ìš©ë¥ ì´ ë†’ë‹¤ë©´)

<br>


## 5ï¸âƒ£ Execution
### 1. ì‰˜ ìŠ¤í¬ë¦½íŠ¸ ì‘ì„± ë° ì €ì¥

#### âœï¸ ì‰˜ ìŠ¤í¬ë¦½íŠ¸
```bash
#!/bin/bash

# ì„¤ì •ê°’
EMAIL="id@gmail.com"   # ê´€ë¦¬ì ì´ë©”ì¼
MEM_THRESHOLD=70            # ê²½ê³  ì•Œë¦¼ ê¸°ì¤€ (%)
CRITICAL_THRESHOLD=90       # ê°•ì œ ì¡°ì¹˜ ê¸°ì¤€ (%)
LOG_FILE="/var/log/db_memory_monitor.log"
HOSTNAME=$(hostname)
MYSQL_USER="..."           # MySQL ì‚¬ìš©ì
MYSQL_PASSWORD="..." # MySQL ë¹„ë°€ë²ˆí˜¸

# í˜„ì¬ ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ í™•ì¸
MEMORY_USAGE=$(free | awk '/Mem:/ {printf("%.0f"), $3/$2 * 100}')
DATE=$(date "+%Y-%m-%d %H:%M:%S")

# ë¡œê·¸ íŒŒì¼ì´ ì—†ìœ¼ë©´ ìƒì„±
if [ ! -f "$LOG_FILE" ]; then
    sudo touch "$LOG_FILE"
    sudo chmod 666 "$LOG_FILE"  # ëª¨ë“  ì‚¬ìš©ìì—ê²Œ ì“°ê¸° ê¶Œí•œ ë¶€ì—¬
fi

# ë¡œê·¸ ê¸°ë¡ í•¨ìˆ˜
log_message() {
    echo "$DATE $1" | tee -a $LOG_FILE
}

# 70% ë¯¸ë§Œì¼ ê²½ìš° memory usage log ì‘ì„±
if [ "$MEMORY_USAGE" -le "$MEM_THRESHOLD" ]; then
    log_message "[INFO] Memory Usage Normal: $MEMORY_USAGE%"
fi


# 1ï¸âƒ£ 70% ì´ˆê³¼ ì‹œ ê´€ë¦¬ìì—ê²Œ ë©”ì¼ ì•Œë¦¼
if [ "$MEMORY_USAGE" -ge "$MEM_THRESHOLD" ]; then
    log_message "[ALERT] Memory Usage High: $MEMORY_USAGE% - Sending alert email"

    MESSAGE="ğŸš¨ [ALERT] DB Server ($HOSTNAME)\nMemory Usage: $MEMORY_USAGE%\nPlease check the server!"
    echo -e "$MESSAGE" | mail -s "[ALERT] DB Server High Memory Usage" $EMAIL
fi

# 2ï¸âƒ£ 90% ì´ˆê³¼ ì‹œ ê¸´ê¸‰ ì¡°ì¹˜ ì‹¤í–‰
if [ "$MEMORY_USAGE" -ge "$CRITICAL_THRESHOLD" ]; then
    log_message "[CRITICAL] Memory Usage Exceeded 90%! Taking actions..."

    # ì˜¤ë˜ ì‹¤í–‰ ì¤‘ì¸ ì¿¼ë¦¬ ì¢…ë£Œ (10ì´ˆ ì´ìƒ ì‹¤í–‰ëœ ì¿¼ë¦¬)
    log_message "[INFO] Killing long running queries..."
    mysql -u "$MYSQL_USER" -p"$MYSQL_PASSWORD" -e "
        SELECT id FROM information_schema.processlist WHERE time > 10;" | while read id; do
        mysql -u "$MYSQL_USER" -p"$MYSQL_PASSWORD" -e "KILL $id;"
    done

    # Idle ì„¸ì…˜ ì¢…ë£Œ (ë¹„í™œì„± ì„¸ì…˜ ì œê±°)
    log_message "[INFO] Terminating idle connections..."
    mysql -u "$MYSQL_USER" -p"$MYSQL_PASSWORD" -e "
        SELECT id FROM information_schema.processlist WHERE command='Sleep' AND time > 60;" | while read id; do
        mysql -u "$MYSQL_USER" -p"$MYSQL_PASSWORD" -e "KILL $id;"
    done

    # ìºì‹œ ì •ë¦¬ (ë¦¬ëˆ…ìŠ¤ OS ë ˆë²¨ ìºì‹œ ì •ë¦¬)
    log_message "[INFO] Dropping caches to free memory..."
    sync; echo 3 | sudo tee /proc/sys/vm/drop_caches

    # Swap ì‚¬ìš©ëŸ‰ í™•ì¸ í›„ í•„ìš”í•˜ë©´ í•´ì œ ë° ì¬í™œì„±í™”
    SWAP_USED=$(free | awk '/Swap:/ {print $3}')
    if [ "$SWAP_USED" -gt 512 ]; then
        log_message "[INFO] Swap usage detected ($SWAP_USED MB). Restarting swap..."
        sudo swapoff -a && sudo swapon -a
    fi

    # ê´€ë¦¬ìì—ê²Œ ì¡°ì¹˜ ì™„ë£Œ ë©”ì¼ ì „ì†¡
    log_message "[INFO] Actions completed. Sending report to admin..."
    MESSAGE="ğŸ”¥ [CRITICAL] DB Server ($HOSTNAME)\nMemory Usage: $MEMORY_USAGE%\nActions Taken:\n- Long running queries killed\n- Idle connections terminated\n- Cache cleared\n- Swap reset (if needed)"
    echo -e "$MESSAGE" | mail -s "[CRITICAL] DB Server Memory Alert - Actions Taken" $EMAIL
fi


```

#### âœ‰ ìŠ¤í¬ë¦½íŠ¸ ì €ì¥
```bash
nano /path/to/db_memory_monitor.sh
```

<br>

### 2. ê¶Œí•œ ë¶€ì—¬
#### ğŸ– íŒŒì¼ì— ì‹¤í–‰ ê¶Œí•œ ë¶€ì—¬
```bash
chmod +x /path/to/db_memory_monitor.sh
```

<br>

### 3. ìë™ ì‹¤í–‰
#### ğŸ• 1ë¶„ë§ˆë‹¤ ìë™ ì‹¤í–‰ë˜ë„ë¡ cronì— ë“±ë¡
```bash
crontab -e
* * * * * /path/to/db_memory_monitor.sh
```

<br>


## 6ï¸âƒ£ Trouble Shooting

### âš” jMeter : driver ì˜¤ë¥˜

Response message:java.sql.SQLException: Cannot load JDBC driver class 'com.mysql.jdbc.Driver'

**ğŸ§¨ì›ì¸:**
![image](https://github.com/user-attachments/assets/c9787e5a-b48b-400c-b7b8-8e7626d147fd)

ì‚¬ìš©í•˜ëŠ” JDBC ë“œë¼ì´ë²„ í´ë˜ìŠ¤ê°€ ì˜ëª»ë¨

JMeter 5.x + MySQL 8.x ì´ìƒ: com.mysql.cj.jdbc.Driver ì‚¬ìš©í•´ì•¼ í•¨!

êµ¬ë²„ì „(MySQL 5.x ì´í•˜): com.mysql.jdbc.Driver ê°€ëŠ¥

<br>

**ğŸ‘Œ í•´ê²°ë°©ì•ˆ**

```copy C:\Users\YourName\Downloads\mysql-connector-java-8.0.33.jar C:\jmeter\lib\```

jmeter\lib\ í´ë”ì— mysql connector jaríŒŒì¼ì„ ë„£ê³  jmeterë¥¼ ì¬ë¶€íŒ…í•œë‹¤.

<br>

## 7ï¸âƒ£ Retrospective

